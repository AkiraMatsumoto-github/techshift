# TechShift 開発ガイドライン

本プロジェクトにおける開発、特にAIアシスタントによるコード編集と検証に関するルールを定めます。
意図しない機能の消失（デグレ）を防ぎ、品質を担保することを目的とします。

## 1. コード編集の原則：最小侵襲 (Minimal Invasive Editing)

既存のコードを修正する際は、**「必要な箇所だけを、最小限の範囲で」**変更することを絶対の原則とします。

### ❌ 悪い例：ファイル全体や巨大なブロックの置換
```python
# 関数の中身を1行変えたいだけなのに、関数全体を再定義して置換する
# リスク：その関数内に（AIが認識していない）他の修正や追加機能が含まれていた場合、それが消滅する
def complex_function():
    # ... 50 lines of code ...
    changed_line() # ここだけ変えたい
    # ... 50 lines of code ...
```

### ✅ 良い例：ピンポイントな差分編集
```python
# 変更したい行とその前後数行だけをターゲットにする
# メリット：前後の文脈が一致しないとエラーになるため、誤った場所への適用や巻き込み事故を防げる
    # ...
    old_line()
    # ...
```
**ルール:**
- `replace_file_content` を使用する際は、変更対象の行数を可能な限り少なくする（推奨：5〜10行以内）。
- `replace_file_content` を使用する際は、変更対象の行数を可能な限り少なくする（推奨：5〜10行以内）。
- ファイル全体を読み込んで再出力するような操作は、新規作成時以外は避ける。

### ⚠️ 禁止事項：既存ファイルの Overwrite
- **禁止:** 既存ファイルに対して `write_to_file (Overwrite=true)` を使用すること。
    - **理由:** 元のファイルに含まれていた文脈（コンテキスト）や重要な行が、意図せず消去されるリスクが高いため。
- **代替策:** 必ず `replace_file_content` または `multi_replace_file_content` を使用し、既存のコンテンツを維持しながら必要な部分だけを変更すること。
- **例外:** 事前に `view_file` で全行を読み込み、消失する内容がないことを確実に検証した場合のみ許可される（それでも非推奨）。

## 2. 検証の原則：成果物ベースの確認 (Outcome-Based Verification)

コードが「エラーなく実行できた」ことと、「正しく機能した」ことは別物です。
必ず**「期待される成果物」**が生成されたかを確認します。

### 確認項目リスト
機能実装や修正を行った後は、以下の観点で検証を行います。

1.  **ファイルの存在確認**:
    - 生成されるべきファイル（記事Markdown、JSON、画像など）が、指定されたディレクトリに実際に存在するか？
    - `ls -l` 等でタイムスタンプとサイズを確認する。

2.  **内容の確認**:
    - 生成されたファイルの中身は空ではないか？
    - 期待されるヘッダーやデータが含まれているか？（`head` や `grep` で確認）

3.  **副作用の確認**:
    - 修正箇所以外の主要機能が動作しているか？（例：記事生成を直したら、保存機能が消えていないか？）

## 3. エラー発生時の対応

- **原因分析**: なぜそのエラー（または消失）が起きたのか、プロセスを遡って特定する。
- **ルールの更新**: 再発防止のために必要な手順があれば、本ガイドラインを更新する。

## 4. クリーンアップ（後始末）

検証のために作成した一時ファイルやデバッグ用スクリプトは、タスク完了時に必ず削除してください。

- **対象:** `debug_*.py`, `check_*.py`, `temp_*` などの一時的なスクリプトやログファイル。
- **タイミング:** 検証が成功し、ユーザーへの最終報告を行う直前。
- **目的:** リポジトリを清潔に保ち、将来の混乱（不要なファイルが残ることによる誤解）を防ぐため。
