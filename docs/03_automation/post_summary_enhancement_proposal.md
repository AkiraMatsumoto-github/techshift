# 提案書：内部リンク精度のためのAI記事要約システムの強化

## 1. 背景
現在、**内部リンク提案機能（Internal Link Suggester）** は、WordPressの `excerpt`（抜粋）フィールドを使用して記事の関連性を判定しています。
- **現状**: `excerpt` には **SEO用メタディスクリプション**（約160文字）が格納されています。これは検索エンジンのクリック率（CTR）向上を目的とした販促的な文章です。
- **課題**: この短い文章では、内部リンクのマッチングに必要な具体的な詳細（サブトピック、特定の技術名、事例企業名など）が不足しており、AIが正確な関連性を判断できません。

## 2. 目的
ユーザー向けのSEO表示（メタディスクリプション）に影響を与えることなく、AIによる関連性判定に特化した「詳細なコンテンツ要約」を生成・保存する仕組みを構築します。

## 3. 解決案

### A. データ構造（カスタムフィールドの活用）
`excerpt` を上書きするのではなく（外観やSEOへの影響を避けるため）、**WordPressのカスタムフィールド**（隠しメタデータ）に構造化された要約を保存します。

- **フィールド名**: `ai_structured_summary` (API公開のためアンダースコアなしに変更)
- **形式**: JSON文字列
- **内容例**:
  ```json
  {
    "summary": "要約テキスト（300-500文字）",
    "key_topics": ["トピックA", "トピックB"],
    "entities": ["会社名", "製品名", "技術名"]
  }
  ```

### B. 新規コンポーネント

#### 1. バッチ要約スクリプト (`automation/batch_summarize.py`)
既存記事に対して要約データをバックフィル（事後生成）するスクリプトです。
- WordPressから全記事を取得。
- `_ai_structured_summary` が未設定の記事を特定。
- 本文全体を取得し、Geminiで詳細なJSON要約を生成。
- 記事のカスタムフィールドを更新。

#### 2. 生成ロジックの更新 (`generate_article.py`)
新規記事作成時にも、この要約を同時に生成するようにパイプラインを修正します。
- 記事本文生成後、`GeminiClient.generate_structured_summary()` を呼び出し。
- `wp.create_post()` 実行時に `meta` パラメータとして保存。

#### 3. 提案ロジックの更新 (`InternalLinkSuggester`)
候補記事の取得ロジックを変更します。
- カスタムフィールド `_ai_structured_summary` を取得。
- データが存在する場合は、その詳細なJSONを使用して関連度スコアリングを行う（精度向上）。
- 存在しない場合は、従来の `excerpt` にフォールバックする。

## 4. 実装計画

1.  **`GeminiClient` への機能追加**
    - 事実やトピックの抽出に最適化したプロンプト `generate_structured_summary` を実装。
2.  **`batch_summarize.py` の作成**
    - 既存の全記事（約20件）に対して実行し、データを整備。
3.  **`generate_article.py` の改修**
    - 新規記事フローへの組み込み。
4.  **`InternalLinkSuggester` の改修**
    - JSONデータを活用したプロンプトへの変更。

## 5. メリット
- **関連性の向上**: タイトルや短いSEO文だけでなく、「記事の中身」に基づいてリンク判定ができるようになります。
- **将来性**: この構造化データは、将来的に「関連記事ウィジェット」や「チャットボットの検索コンテキスト」、「自動タグ付け」などにも活用可能です。
- **UIへの影響なし**: サイトの見た目やSEO設定（メタディスクリプション）は変更されません。
